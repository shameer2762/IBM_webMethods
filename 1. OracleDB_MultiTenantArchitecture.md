# 📘 Oracle Multitenant Architecture (CDB & PDB)

<img width="286" height="138" alt="MultiTenant architecture" src="https://github.com/user-attachments/assets/7f45bb29-21e7-4026-8126-bdad07522b19" />

## 1. What is a CDB (Container Database)?

A **CDB** is the main **container database** in Oracle’s multitenant architecture (introduced from Oracle 12c).

* It provides the **common infrastructure** (memory, background processes, system metadata).
* It acts as the **foundation** where multiple **PDBs** (Pluggable Databases) can exist.
* Instead of creating multiple separate databases, Oracle allows you to create **one CDB** and host many PDBs inside it.

👉 **Analogy:**
Think of a **CDB as an apartment building**:

* Provides electricity, water, lifts, and security (common services).
* Inside the building, there are independent **flats (PDBs)**.

---

## 2. What is a PDB (Pluggable Database)?

A **PDB** is a **self-contained database** that resides inside a CDB.

* It has its **own users, schemas, and data files**.
* Each PDB is **independent** → data in one PDB does not affect another.
* But PDBs **share the common infrastructure** from the CDB.

👉 **Analogy:**
Each **flat in the building** (PDB) belongs to a different family:

* Families are independent.
* If one paints their walls blue (modifies data), it does not affect neighbors.
* But all share the same lifts, electricity, and security (CDB resources).

---

## 3. Root, Seed, and PDB

* **CDB\$ROOT (Root Container):**

  * The **foundation** of the CDB.
  * Stores Oracle system metadata and common services.
  * Does not contain user business data.

* **PDB\$SEED (Seed Database):**

  * A **read-only template PDB**.
  * Used only for **creating new PDBs** quickly.
  * Cannot be modified directly.

* **Pluggable Database (PDB):**

  * Independent, fully functional database.
  * Holds business/application data.
  * Can be unplugged from one CDB and plugged into another.

---

## 4. Users in CDB and PDB

Oracle divides users into **two categories**:

### (a) Common Users (CDB Users)

* Exist in **all containers (CDB + all PDBs)**.
* Created in the **CDB Root**.
* Must begin with prefix **`C##`**.
* Used mainly by **DBAs** to manage the entire system.

👉 Example:

```sql
ALTER SESSION SET CONTAINER = CDB$ROOT;
CREATE USER C##ADMIN IDENTIFIED BY admin123 CONTAINER=ALL;
GRANT DBA TO C##ADMIN CONTAINER=ALL;
```

### (b) Local Users (PDB Users)

* Exist **only inside a specific PDB**.
* Created when connected to a particular PDB.
* Used by **application developers and end-users**.

👉 Example:

```sql
ALTER SESSION SET CONTAINER = XEPDB1;
CREATE USER hr_user IDENTIFIED BY hr_pass;
GRANT CONNECT, RESOURCE TO hr_user;
```

---

## 5. Why Create Users Separately in CDB and PDB?

* **CDB Users** → Needed for **administration across all PDBs**. Example: A DBA managing the full database system.
* **PDB Users** → Needed for **business applications** inside each PDB. Example: HR application in HRPDB, Sales application in SALESPDB.

👉 Without **local users**, you cannot store or access data inside a PDB.
👉 Without **common users**, you cannot perform administrative tasks across containers.

---

## 6. Real-Time Example

A **Bank** 🏦 using Oracle multitenant:

* **CDB (Bank Building)** → Provides shared infrastructure.
* **PDBs (Flats):**

  * `LoanPDB` → Loans data
  * `CardPDB` → Credit card transactions
  * `HRPDB` → Employee information
* **Common User (`C##DBA`)** → Bank DBA, manages all PDBs.
* **Local Users (`loan_user`, `card_user`, `hr_user`)** → Application users for specific departments.

---


---

## 🏗️ Multi-Tenant Architecture — Quick Definition

**Multi-tenant architecture** means a **single software instance** (application, database, or platform) serves **multiple customers (tenants)** — while keeping their **data, configurations, and processes isolated** from each other.

Each **tenant** is logically isolated but physically shares the same underlying infrastructure.

---

## 🌐 How Multi-Tenancy Relates to webMethods

### 1. **webMethods.io Integration (iPaaS)**

Multi-tenancy is **natively implemented** in **webMethods.io**, as it is a **cloud-based Integration Platform as a Service (iPaaS)**.

| Aspect                    | Description                                                                                                                                         |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Tenant Definition**     | A tenant in webMethods.io represents an **organization or account** (e.g., a customer, business unit, or project).                                  |
| **Resource Isolation**    | Each tenant has **its own workspace**, users, connections, and projects — isolated from other tenants.                                              |
| **Shared Infrastructure** | All tenants share the **same application layer** and **underlying infrastructure** (like servers, storage, and runtime).                            |
| **Security Boundary**     | Tenants cannot access or view data of other tenants — isolation is maintained through **tenant IDs**, **data encryption**, and **access controls**. |
| **Scalability**           | Multi-tenancy allows Software AG to **dynamically scale** and host hundreds of tenants without deploying separate infrastructure for each.          |

🧩 **Example:**
You (Tenant A) create an integration in webMethods.io to connect Azure Blob Storage and SAP.
Another company (Tenant B) also uses webMethods.io for Salesforce-to-Snowflake integration.
Both use the **same platform instance**, but your pipelines, credentials, and execution logs are **completely isolated**.

---

### 2. **On-Premise webMethods Integration Server**

In **traditional on-prem deployments**, webMethods IS itself is **not inherently multi-tenant**, but you can **design multi-tenant-like environments** using:

| Approach                                   | Explanation                                                                                                                  |
| ------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------- |
| **Multiple Integration Servers**           | Deploy separate IS instances (or packages) for each tenant/customer — each with its own configuration and security settings. |
| **Namespace / Folder Isolation**           | Create separate namespaces (e.g., `TenantA.services`, `TenantB.services`) within a single IS, ensuring logical isolation.    |
| **User and ACL Segregation**               | Use Access Control Lists (ACLs) and groups to restrict access to specific services or data per tenant.                       |
| **Dedicated Database Schemas**             | Each tenant can have its own database schema for configuration and runtime data isolation.                                   |
| **Custom Tenant Identifier in Flow Logic** | Add a tenant ID as part of your pipeline to handle routing, logging, and security per tenant.                                |

🧩 **Example:**
In a B2B setup, if your webMethods IS integrates multiple clients’ EDI transactions, each client (tenant) can have:

* Its own EDI schema and trading partner profile
* Separate inbound/outbound folders
* Custom processing rules

---

### 3. **Hybrid Multi-Tenancy**

Many enterprises use **hybrid setups** where:

* **webMethods.io** hosts the **multi-tenant cloud integration layer**,
* and **on-prem IS** handles **tenant-specific or sensitive processes**.

In this case, multi-tenancy exists **at the design and deployment level**, not just at the infrastructure level.

---

## 🔒 Key Benefits of Multi-Tenant Architecture in webMethods.io

* ✅ **Efficient resource usage** – One runtime serves many customers.
* ✅ **Lower maintenance cost** – Updates, patches, and upgrades are centralized.
* ✅ **High scalability** – Elastic scaling for large tenant workloads.
* ✅ **Security and data isolation** – Tenant data is separated logically and encrypted.
* ✅ **Simplified onboarding** – Quick setup for new tenants without new hardware.

---

## ⚙️ Summary

| Environment                 | Multi-Tenant Support | How It’s Achieved                                                             |
| --------------------------- | -------------------- | ----------------------------------------------------------------------------- |
| **webMethods.io (Cloud)**   | ✅ Native             | Each org/account is a tenant with isolated workspace and resources            |
| **webMethods IS (On-Prem)** | ⚙️ Configurable      | Logical or physical separation using multiple IS instances, ACLs, and schemas |
| **Hybrid Setup**            | 🧩 Combined          | Cloud-level multi-tenancy + on-prem tenant-specific processing                |

---

## 💡 Interview Tip

If asked *“How does webMethods support multi-tenancy?”*, you can say:

> “webMethods.io Integration is built on a multi-tenant cloud architecture where each organization acts as a tenant with isolated projects, users, and data, while sharing the same underlying infrastructure. On-premise Integration Server, though single-tenant by default, can be configured to simulate multi-tenancy through namespace segregation, ACLs, and multiple IS instances.”

---


## 7. Oracle 21c – SQL Commands Reference

### 🔹 Check Current Container

```sql
SHOW CON_NAME;
```

### 🔹 Switch from CDB to PDB

```sql
ALTER SESSION SET CONTAINER = <pluggableDatabase>;
```

### 🔹 View All Users

```sql
SELECT * FROM ALL_USERS;
```

### 🔹 View All Pluggable Databases

```sql
SELECT NAME FROM V$PDBS;
```

### 🔹 Check Database Name (CDB)

```sql
SELECT NAME FROM V$DATABASE;
```

### 🔹 Connect to Database

```sql
CONNECT <username>/<password>@<hostName>:<port>/<containerDatabase|pluggableDatabase> AS SYSDBA;
```

---

## 8. User Creation & Privileges

### 🔹 Create User in CDB (Common User)

```sql
ALTER SESSION SET CONTAINER = CDB$ROOT;
CREATE USER C##<username> IDENTIFIED BY <password>;
```

### 🔹 Create User in PDB (Local User)

```sql
ALTER SESSION SET CONTAINER = XEPDB1;
CREATE USER <username> IDENTIFIED BY <password>;
```

### 🔹 Grant Privileges

```sql
GRANT CREATE SESSION TO <username>;
GRANT CONNECT, RESOURCE, DBA TO <username>;
GRANT UNLIMITED TABLESPACE TO <username>;
GRANT CREATE VIEW, CREATE PROCEDURE, CREATE SEQUENCE, CREATE TRIGGER TO <username>;
GRANT ALL PRIVILEGES TO <username>;
```

---

## 9. ✅ Summary

* **CDB (Container Database):** Foundation, provides shared infrastructure.
* **PDB (Pluggable Database):** Independent databases inside a CDB.
* **Root (`CDB$ROOT`):** Common metadata and Oracle system data.
* **Seed (`PDB$SEED`):** Template for creating new PDBs.
* **Common Users (CDB):** Created in root, exist in all PDBs (used by DBAs).
* **Local Users (PDB):** Created in individual PDBs, used for business applications.

👉 **Benefit:** One CDB can host multiple PDBs, reducing cost, resource usage, and administration while keeping data securely isolated.
